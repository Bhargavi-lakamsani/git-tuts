pipeline {
    agent none

    }
    environment {
        ENV_VAR_STRING = "${params.STRING_ENV}"
        ENV_VAR_CHOICE = "${params.CHOICE_ENV}"
        ENV_VAR_BOOLEAN = "${params.BOOLEAN_ENV}"
    }
    
   parameters {
      string defaultValue: 'Bhargavi', description: 'choose your name', name: 'STRING_ENV'
      choice choices: ['DEV', 'PROD', 'TEST'], description: 'choose your choice', name: 'CHOICE_ENV'
      booleanParam defaultValue: true, description: 'default value true', name: 'BOOLEAN_EN'
}
  
    stages {
        stage('Stage 1') {
            agent { label 'agent1' }
            steps {
                script {
                    // Access and use the environment variables
                    echo "String Environment Variable: ${ENV_VAR_STRING}"
                    echo "Choice Environment Variable: ${ENV_VAR_CHOICE}"
                    echo "Boolean Environment Variable: ${ENV_VAR_BOOLEAN}"
                    
                    // Use global variables
                    echo "Build Number: ${BUILD_NUMBER}"
                    echo "Job Name: ${JOB_NAME}"
                    echo "Workspace: ${WORKSPACE}"
                    echo "Node Name: ${NODE_NAME}"
                }
            }
        }
        stage('Stage 2') {
            agent { label 'agent1' }
            steps {
                script {
                    println "Performing Stage 2 in agent1"
                }
            }
            post {
                success {
                    echo 'Stage 2 completed successfully'
                }
            }
        }
        stage('Stage 3') {
            agent { label 'agent2' }
            when {
                allOf {
                    expression { params.CHOICE_ENV == 'DEV' }
                    expression { success_of_stage_2 == true }
                    branch 'master'
                }
            }
            steps {
                script {
                    println "Performing Stage 3 in agent2"
                }
            }
            post {
                success {
                    echo 'Stage 3 completed successfully'
                }
            }
        }
        stage('Stage 4') {
            agent { label 'agent2' }
            when {
                allOf {
                    expression { params.BOOLEAN_ENV }
                    expression { success_of_stage_3 == true }
                }
            }
            steps {
                script {
                    println "Performing Stage 4 in Agent 2"
                }
            }
            post {
                success {
                    echo 'Stage 4 completed successfully'
                }
            }
        }
    }
    triggers {
        cron('H/5 * * * *')
        pollSCM('* * * * *')
    }
    post {
        always {
            echo 'Pipeline completed'
        }
        success {
            mail to: 'navatabhargavi@gmail.com',
                subject: "Pipeline ${env.JOB_NAME} - Build #${env.BUILD_NUMBER} Successful",
                body: "Congratulations! Your Jenkins pipeline build was successful."
        }
        failure {
            mail to: 'navatabhargavi@gmail.com',
                subject: "Pipeline ${env.JOB_NAME} - Build #${env.BUILD_NUMBER} Failed",
                body: "Sorry, your Jenkins pipeline build failed. Please check the logs for details."
        }
    }
}
